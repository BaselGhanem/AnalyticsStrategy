<!DOCTYPE html>

<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics Strategy & Operations | Basel Ghanem</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
brand: {
DEFAULT: '#099999',
dark: '#066666',
light: '#14cccc',
bg: '#f0fbfb'
},
slate: {
850: '#151e2e'
}
},
fontFamily: {
sans: ['Inter', 'system-ui', 'sans-serif'],
}
}
}
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
body { font-family: 'Inter', sans-serif; }
.fade-in-up {
opacity: 0;
transform: translateY(20px);
transition: opacity 0.8s ease-out, transform 0.8s ease-out;
}
.fade-in-up.visible {
opacity: 1;
transform: translateY(0);
}
.glass-panel {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.2);
}
.metric-card {
transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.metric-card:hover {
transform: translateY(-2px);
box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
}
canvas { max-height: 350px; }
</style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased selection:bg-brand selection:text-white">

<nav class="fixed w-full z-50 glass-panel border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
            <div class="flex-shrink-0 flex items-center gap-2">
                <i data-lucide="bar-chart-2" class="text-brand h-6 w-6"></i>
                <span class="font-bold text-xl text-slate-850 tracking-tight">Analytics<span class="text-brand">Strategy</span></span>
            </div>
            <div class="hidden md:flex space-x-8 text-sm font-medium text-gray-600">
                <a href="#executive" class="hover:text-brand transition-colors">Executive Summary</a>
                <a href="#architecture" class="hover:text-brand transition-colors">Architecture</a>
                <a href="#strategy" class="hover:text-brand transition-colors">Sales Strategy</a>
                <a href="#scoring" class="hover:text-brand transition-colors">Lead Scoring</a>
                <a href="#dashboard" class="bg-brand text-white px-4 py-2 rounded-full hover:bg-brand-dark transition-colors">Live Dashboard</a>
            </div>
        </div>
    </div>
</nav>

<header class="pt-32 pb-20 px-6 max-w-7xl mx-auto text-center md:text-left fade-in-up">
    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-brand-bg text-brand text-sm font-semibold mb-6">
        <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-brand opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-brand"></span>
        </span>
        Regional Sales Operations Associate - Analytics
    </div>
    <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight text-slate-850 mb-6 leading-tight">
        Transforming Data into <br/><span class="text-brand">Revenue Operations Excellence</span>
    </h1>
    <p class="mt-4 text-xl text-gray-600 max-w-3xl leading-relaxed">
        Presented by Basel Ghanem. An interactive product demonstrating end-to-end strategic systems thinking, analytics execution, and proactive leadership to scale regional sales performance.
    </p>
</header>

<section id="executive" class="py-16 bg-white border-y border-gray-100">
    <div class="max-w-7xl mx-auto px-6">
        <h2 class="text-3xl font-bold text-slate-850 mb-10 flex items-center gap-3 fade-in-up">
            <i data-lucide="target" class="text-brand"></i> Why I am the Ideal Candidate
        </h2>
        <div class="grid md:grid-cols-3 gap-8">
            <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100 fade-in-up">
                <div class="w-12 h-12 bg-brand-bg text-brand rounded-xl flex items-center justify-center mb-4">
                    <i data-lucide="zap" class="w-6 h-6"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-850 mb-3">Bias for Action</h3>
                <p class="text-gray-600 text-sm leading-relaxed">
                    Moving from raw insight to commercial execution rapidly. I don't just build reports; I build operational triggers. By leveraging over 15 years of professional experience, I identify pipeline bottlenecks and immediately orchestrate corrective workflows with sales leadership.
                </p>
            </div>
            <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100 fade-in-up" style="transition-delay: 100ms;">
                <div class="w-12 h-12 bg-brand-bg text-brand rounded-xl flex items-center justify-center mb-4">
                    <i data-lucide="database" class="w-6 h-6"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-850 mb-3">Data-First Mindset</h3>
                <p class="text-gray-600 text-sm leading-relaxed">
                    Establishing a single source of truth is non-negotiable. My background includes architecting complex data models and comprehensive training programs for advanced Power BI and Excel, ensuring teams operate on validated, governable, and structured commercial data.
                </p>
            </div>
            <div class="p-6 bg-gray-50 rounded-2xl border border-gray-100 fade-in-up" style="transition-delay: 200ms;">
                <div class="w-12 h-12 bg-brand-bg text-brand rounded-xl flex items-center justify-center mb-4">
                    <i data-lucide="shield-check" class="w-6 h-6"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-850 mb-3">Ownership Mentality</h3>
                <p class="text-gray-600 text-sm leading-relaxed">
                    End-to-end accountability. As the first analytics hire in a region, I view the revenue engine as my own product. From data ingestion to the rep's daily dashboard, I own the outcome, the accuracy, and the adoption of the analytics stack.
                </p>
            </div>
        </div>
    </div>
</section>

<section id="architecture" class="py-20 px-6 max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold text-slate-850 mb-4 flex items-center gap-3 fade-in-up">
        <i data-lucide="layers" class="text-brand"></i> Building the Regional Analytics Stack
    </h2>
    <p class="text-gray-600 mb-10 max-w-3xl fade-in-up">First analytics hire strategy: Balance immediate operational needs with the construction of a scalable, long-term foundation. Deploy minimum viable reporting immediately while architecting the enterprise data warehouse simultaneously.</p>
    
    <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 mb-10 fade-in-up">
        <h3 class="text-lg font-bold text-slate-850 mb-6 border-b pb-4">Implementation Roadmap</h3>
        <div class="grid md:grid-cols-3 gap-6 relative">
            <div class="hidden md:block absolute top-1/2 left-0 w-full h-0.5 bg-gray-100 -z-10 -translate-y-1/2"></div>
            
            <div class="bg-white border border-gray-200 p-6 rounded-xl relative">
                <span class="absolute -top-3 left-6 bg-brand text-white text-xs font-bold px-3 py-1 rounded-full">Days 1-30</span>
                <h4 class="font-bold text-slate-850 mt-2 mb-2">Audit & Quick Wins</h4>
                <ul class="text-sm text-gray-600 space-y-2">
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Audit existing CRM hygiene and data flows.</li>
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Deploy core "Keep The Lights On" (KTLO) daily pacing reports.</li>
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Establish alignment with RGM on immediate KPI definitions.</li>
                </ul>
            </div>
            
            <div class="bg-white border border-gray-200 p-6 rounded-xl relative">
                <span class="absolute -top-3 left-6 bg-brand text-white text-xs font-bold px-3 py-1 rounded-full">Days 31-60</span>
                <h4 class="font-bold text-slate-850 mt-2 mb-2">Architecture & Governance</h4>
                <ul class="text-sm text-gray-600 space-y-2">
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Build structured data models (fact/dimension tables).</li>
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Implement automated ETL pipelines minimizing manual Excel work.</li>
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Deploy tiered dashboard hierarchy (GM, Manager, Rep).</li>
                </ul>
            </div>

            <div class="bg-white border border-gray-200 p-6 rounded-xl relative">
                <span class="absolute -top-3 left-6 bg-brand text-white text-xs font-bold px-3 py-1 rounded-full">Days 61-90</span>
                <h4 class="font-bold text-slate-850 mt-2 mb-2">Advanced Optimization</h4>
                <ul class="text-sm text-gray-600 space-y-2">
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Roll out predictive forecasting and capacity planning models.</li>
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Train sales managers on utilizing data for active coaching.</li>
                    <li class="flex items-start gap-2"><i data-lucide="check-circle-2" class="w-4 h-4 text-brand shrink-0 mt-0.5"></i> Implement lead scoring simulations.</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<section id="strategy" class="py-20 bg-slate-850 text-white relative overflow-hidden">
    <div class="absolute top-0 left-0 w-full h-1 bg-brand"></div>
    <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-16 relative z-10">
        <div class="fade-in-up">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <i data-lucide="trending-up" class="text-brand"></i> Sales Strategy & Planning
            </h2>
            <div class="space-y-6">
                <div>
                    <h4 class="text-brand font-bold mb-1">Territory Planning & Capacity</h4>
                    <p class="text-gray-300 text-sm leading-relaxed">Logic-driven routing based on Total Addressable Market (TAM), account density, and historical rep velocity. Balancing territories ensures equitable quota attainment potential and prevents burnout or underserved accounts.</p>
                </div>
                <div>
                    <h4 class="text-brand font-bold mb-1">Pipeline & Forecasting Framework</h4>
                    <p class="text-gray-300 text-sm leading-relaxed">Transitioning from subjective "commit" calls to probability-weighted pipeline management. Forecasting is grounded in historical stage-to-stage conversion rates adjusted by average sales cycle length per segment.</p>
                </div>
                <div>
                    <h4 class="text-brand font-bold mb-1">Growth Levers</h4>
                    <p class="text-gray-300 text-sm leading-relaxed">Identifying adjacent product adoption, up-sell triggers based on utilization metrics, and reducing time-to-first-value to drive net revenue retention (NRR).</p>
                </div>
            </div>
        </div>

        <div id="scoring" class="bg-slate-800 p-8 rounded-2xl border border-slate-700 fade-in-up" style="transition-delay: 200ms;">
            <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">
                <i data-lucide="cpu" class="text-brand"></i> Lead Scoring Model Design
            </h3>
            <div class="bg-slate-900 rounded-lg p-4 mb-4 font-mono text-xs text-brand-light">
                <p>// Scoring Logic Matrix</p>
                <p>Score = (w1 * Firmographics) + (w2 * Behavior) + (w3 * Velocity)</p>
            </div>
            <ul class="space-y-4 text-sm text-gray-300">
                <li><strong class="text-white">Inputs:</strong> Historical cancellation rate (negative weight), Average Order Volume thresholds, Sales cycle duration, Industry vertical.</li>
                <li><strong class="text-white">Assumptions:</strong> Past engagement behavior is a 2x stronger predictor of conversion than static firmographics. Order volume scales non-linearly with account size.</li>
                <li><strong class="text-white">Evaluation Metrics:</strong> Model efficacy is measured via Conversion Lift by Decile and reduction in Sales Cycle length for A-tier leads.</li>
                <li><strong class="text-white">Iteration Framework:</strong> Monthly retrospective comparing model-predicted win rates against actual closed-won data to recalibrate weights continuously.</li>
            </ul>
        </div>
    </div>
</section>

<section class="py-20 bg-gray-50 border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6">
        <h2 class="text-3xl font-bold text-slate-850 mb-10 text-center fade-in-up">Tiered Reporting & KPI Framework</h2>
        <div class="grid md:grid-cols-3 gap-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 fade-in-up">
                <div class="border-b border-gray-100 pb-4 mb-4">
                    <h3 class="text-xl font-bold text-slate-850">Regional GM</h3>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Strategic & Financial</p>
                </div>
                <ul class="space-y-3 text-sm text-gray-700">
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Revenue vs Target</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>YoY / MoM Growth Rate</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Forecast Accuracy</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between pb-2"><span>Net Revenue Retention</span> <span class="font-bold text-brand">Action</span></li>
                </ul>
                <p class="text-xs text-gray-500 mt-4 italic">Drives resource allocation, high-level course correction, and corporate reporting.</p>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-brand/30 ring-1 ring-brand/10 fade-in-up" style="transition-delay: 100ms;">
                <div class="border-b border-gray-100 pb-4 mb-4">
                    <h3 class="text-xl font-bold text-slate-850">Sales Managers</h3>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Operational & Coaching</p>
                </div>
                <ul class="space-y-3 text-sm text-gray-700">
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Pipeline Coverage (3x-4x)</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Stage Conversion Rates</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Rep Productivity Dist.</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between pb-2"><span>Sales Cycle Length</span> <span class="font-bold text-brand">Action</span></li>
                </ul>
                <p class="text-xs text-gray-500 mt-4 italic">Triggers 1:1 coaching, pipeline scrubbing, and deal desk interventions.</p>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 fade-in-up" style="transition-delay: 200ms;">
                <div class="border-b border-gray-100 pb-4 mb-4">
                    <h3 class="text-xl font-bold text-slate-850">Sales Reps</h3>
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Tactical & Execution</p>
                </div>
                <ul class="space-y-3 text-sm text-gray-700">
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Activity vs Outcome</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Lead Velocity Rate</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between border-b border-gray-50 pb-2"><span>Average Order Volume</span> <span class="font-bold text-brand">Action</span></li>
                    <li class="flex justify-between pb-2"><span>Personal Quota Pacing</span> <span class="font-bold text-brand">Action</span></li>
                </ul>
                <p class="text-xs text-gray-500 mt-4 italic">Focuses daily workflow, prioritizes outreach, and motivates via gamification.</p>
            </div>
        </div>
    </div>
</section>

<section id="dashboard" class="py-20 px-6 max-w-7xl mx-auto">
    <div class="flex flex-col md:flex-row justify-between items-end mb-8 fade-in-up">
        <div>
            <h2 class="text-3xl font-bold text-slate-850 flex items-center gap-3">
                <i data-lucide="layout-dashboard" class="text-brand"></i> Customer Health Dashboard
            </h2>
            <p class="text-gray-600 mt-2">Interactive analytics processing directly in the browser. <strong class="text-slate-850">Zero server calls.</strong></p>
        </div>
        
        <div class="mt-4 md:mt-0 w-full md:w-auto bg-white p-4 rounded-xl border border-brand shadow-sm flex items-center gap-4">
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-700 mb-1 uppercase tracking-wide">Data Source (Orders.csv)</label>
                <input type="file" id="csvFileInput" accept=".csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-xs file:font-semibold file:bg-brand-bg file:text-brand hover:file:bg-brand-light transition-all cursor-pointer"/>
            </div>
        </div>
    </div>

    <div id="loadingState" class="hidden text-center py-20">
        <i data-lucide="loader-2" class="w-10 h-10 text-brand animate-spin mx-auto mb-4"></i>
        <p class="text-gray-500 font-medium">Processing dataset and computing dynamic metrics...</p>
    </div>

    <div id="dashboardContent" class="hidden opacity-0 transition-opacity duration-1000">
        
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-8 flex gap-3">
            <i data-lucide="info" class="text-blue-500 shrink-0 mt-0.5"></i>
            <div class="text-sm text-blue-900">
                <strong>Timebox Simulation Assumptions:</strong> Due to execution constraints, analysis focuses on immediate revenue generation and churn risk. 
                <em>Health Score = (Normalized Revenue * 0.6) + ((1 - Cancel Rate) * 0.4)</em>. 
                Any brand with >10% cancellation rate is flagged for immediate RGM review.
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
            <div class="metric-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <p class="text-sm text-gray-500 font-medium mb-1">Total Valid Revenue</p>
                <h3 id="kpi-revenue" class="text-3xl font-bold text-slate-850">$0</h3>
            </div>
            <div class="metric-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <p class="text-sm text-gray-500 font-medium mb-1">Total Net Orders</p>
                <h3 id="kpi-orders" class="text-3xl font-bold text-slate-850">0</h3>
            </div>
            <div class="metric-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <p class="text-sm text-gray-500 font-medium mb-1">Average Order Vol.</p>
                <h3 id="kpi-aov" class="text-3xl font-bold text-brand">$0</h3>
            </div>
            <div class="metric-card bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden">
                <p class="text-sm text-gray-500 font-medium mb-1">Cancellation Rate</p>
                <h3 id="kpi-cancel" class="text-3xl font-bold text-slate-850">0%</h3>
                <div id="risk-banner" class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg hidden">HIGH RISK</div>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-slate-850 mb-4 flex items-center justify-between">
                    Revenue Trend (Week over Week)
                    <i data-lucide="bar-chart-3" class="w-4 h-4 text-gray-400"></i>
                </h3>
                <canvas id="wowChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                <h3 class="font-bold text-slate-850 mb-4 flex items-center justify-between">
                    Top 5 Brands by Revenue
                    <i data-lucide="pie-chart" class="w-4 h-4 text-gray-400"></i>
                </h3>
                <canvas id="brandChart"></canvas>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-slate-850">Brand Health & Risk Matrix</h3>
                <button id="exportBtn" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded-md transition-colors flex items-center gap-2">
                    <i data-lucide="download" class="w-3 h-3"></i> Export
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-500 uppercase bg-gray-50">
                        <tr>
                            <th class="px-6 py-4">Brand / Organization</th>
                            <th class="px-6 py-4 text-right">Revenue</th>
                            <th class="px-6 py-4 text-center">Orders</th>
                            <th class="px-6 py-4 text-center">Cancel Rate</th>
                            <th class="px-6 py-4 text-center">Health Score</th>
                            <th class="px-6 py-4">Status</th>
                        </tr>
                    </thead>
                    <tbody id="brandTableBody" class="divide-y divide-gray-100">
                        </tbody>
                </table>
            </div>
        </div>

    </div>

    <div id="placeholderState" class="bg-white border-2 border-dashed border-gray-200 rounded-2xl p-16 text-center">
        <i data-lucide="table" class="w-12 h-12 text-gray-300 mx-auto mb-4"></i>
        <h3 class="text-lg font-bold text-slate-850 mb-2">Awaiting Dataset</h3>
        <p class="text-gray-500 max-w-md mx-auto">Upload the provided <code class="text-brand">KitchenPark sample data (1) - Orders.csv</code> file above to initialize the executive simulation engine.</p>
    </div>
</section>

<footer class="bg-slate-900 py-8 text-center border-t border-slate-800">
    <p class="text-slate-400 text-sm flex items-center justify-center gap-2">
        Strategic Analytics Submission <span class="w-1 h-1 rounded-full bg-brand"></span> Designed & Architected by Basel Ghanem
    </p>
</footer>

<script>
    // Initialize Lucide Icons
    lucide.createIcons();

    // Scroll animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.fade-in-up').forEach(el => observer.observe(el));

    // Chart instances
    let wowChartInstance = null;
    let brandChartInstance = null;

    // Currency Formatter
    const formatter = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
    });

    // File Upload Handler
    document.getElementById('csvFileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        document.getElementById('placeholderState').style.display = 'none';
        document.getElementById('dashboardContent').style.display = 'none';
        document.getElementById('loadingState').style.display = 'block';

        Papa.parse(file, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                setTimeout(() => {
                    processAnalytics(results.data);
                    document.getElementById('loadingState').style.display = 'none';
                    const dashboard = document.getElementById('dashboardContent');
                    dashboard.style.display = 'block';
                    // Trigger reflow
                    void dashboard.offsetWidth; 
                    dashboard.classList.remove('opacity-0');
                }, 600); // Artificial delay for premium UX feel
            }
        });
    });

    function processAnalytics(data) {
        let totalRevenue = 0;
        let totalOrders = 0;
        let canceledOrders = 0;
        
        let weekData = {};
        let brandData = {};

        // Data Transformation loop
        data.forEach(row => {
            const status = row['OrderStatus'] || '';
            // Handle different CSV structures gracefully
            const subtotal = parseFloat(row['Subtotal'] || row['Subtotal '] || row['Total'] || 0);
            const week = row['week'] || 'Unknown';
            const brand = row['brand name'] || row['Store'] || 'Unknown Brand';
            const org = row['org name'] || 'Unknown Org';

            if (!status) return; // Skip empty rows

            totalOrders++;

            if (status.trim().toLowerCase() === 'canceled') {
                canceledOrders++;
            } else {
                totalRevenue += subtotal;
                
                // Aggregate Week
                weekData[week] = (weekData[week] || 0) + subtotal;
                
                // Aggregate Brand
                if (!brandData[brand]) {
                    brandData[brand] = { revenue: 0, orders: 0, cancels: 0, org: org };
                }
                brandData[brand].revenue += subtotal;
                brandData[brand].orders++;
            }
        });

        // If a row was entirely a cancel, it might not have hit the brand order increment correctly based on simplified logic, 
        // doing a second pass for cancels specific to brand to ensure accurate rate:
        data.forEach(row => {
            const status = row['OrderStatus'] || '';
            const brand = row['brand name'] || row['Store'] || 'Unknown Brand';
            if (status.trim().toLowerCase() === 'canceled') {
                if (brandData[brand]) brandData[brand].cancels++;
            }
        });

        // Top-Level KPIs
        const netOrders = totalOrders - canceledOrders;
        const cancelRate = totalOrders > 0 ? (canceledOrders / totalOrders) * 100 : 0;
        const aov = netOrders > 0 ? totalRevenue / netOrders : 0;

        document.getElementById('kpi-revenue').innerText = formatter.format(totalRevenue);
        document.getElementById('kpi-orders').innerText = netOrders.toLocaleString();
        document.getElementById('kpi-aov').innerText = formatter.format(aov);
        document.getElementById('kpi-cancel').innerText = cancelRate.toFixed(1) + '%';

        if (cancelRate > 10) {
            document.getElementById('risk-banner').classList.remove('hidden');
            document.getElementById('kpi-cancel').classList.add('text-red-600');
        } else {
            document.getElementById('risk-banner').classList.add('hidden');
            document.getElementById('kpi-cancel').classList.remove('text-red-600');
        }

        // --- Charts Setup ---
        
        // WOW Chart
        const sortedWeeks = Object.keys(weekData).filter(k => k !== 'Unknown').sort((a,b) => parseInt(a)-parseInt(b));
        const wowLabels = sortedWeeks.map(w => 'Week ' + w);
        const wowValues = sortedWeeks.map(w => weekData[w]);

        if (wowChartInstance) wowChartInstance.destroy();
        wowChartInstance = new Chart(document.getElementById('wowChart'), {
            type: 'line',
            data: {
                labels: wowLabels,
                datasets: [{
                    label: 'Gross Revenue',
                    data: wowValues,
                    borderColor: '#099999',
                    backgroundColor: 'rgba(9, 153, 153, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: '#099999',
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { borderDash: [4, 4], color: '#f3f4f6' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // Brand Chart (Top 5)
        const sortedBrands = Object.entries(brandData)
            .sort((a, b) => b[1].revenue - a[1].revenue)
            .slice(0, 5);
        
        if (brandChartInstance) brandChartInstance.destroy();
        brandChartInstance = new Chart(document.getElementById('brandChart'), {
            type: 'doughnut',
            data: {
                labels: sortedBrands.map(b => b[0]),
                datasets: [{
                    data: sortedBrands.map(b => b[1].revenue),
                    backgroundColor: ['#099999', '#14cccc', '#066666', '#4dd2d2', '#a6e8e8'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: { position: 'right', labels: { boxWidth: 12, font: { size: 11 } } }
                }
            }
        });

        // Table Generation with Scoring Logic
        const tbody = document.getElementById('brandTableBody');
        tbody.innerHTML = '';
        
        // Calculate max revenue for normalization
        const maxRev = Math.max(...Object.values(brandData).map(b => b.revenue));

        Object.entries(brandData)
            .sort((a, b) => b[1].revenue - a[1].revenue)
            .slice(0, 10) // Top 10 for table
            .forEach(([brandName, stats]) => {
                const totalBrandOrders = stats.orders + stats.cancels;
                const bCancelRate = totalBrandOrders > 0 ? stats.cancels / totalBrandOrders : 0;
                
                // Score Formula: (Normalized Rev * 0.6) + ((1 - Cancel Rate) * 0.4)
                const normRev = maxRev > 0 ? (stats.revenue / maxRev) : 0;
                const healthScore = ((normRev * 0.6) + ((1 - bCancelRate) * 0.4)) * 100;

                let statusBadge = '';
                if (bCancelRate > 0.10) {
                    statusBadge = '<span class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-bold">Review Required</span>';
                } else if (healthScore > 75) {
                    statusBadge = '<span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold">Healthy</span>';
                } else {
                    statusBadge = '<span class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold">Monitor</span>';
                }

                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50 transition-colors';
                tr.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="font-bold text-slate-850">${brandName.substring(0, 25)}${brandName.length > 25 ? '...' : ''}</div>
                        <div class="text-xs text-gray-500">${stats.org}</div>
                    </td>
                    <td class="px-6 py-4 text-right font-medium text-slate-850">${formatter.format(stats.revenue)}</td>
                    <td class="px-6 py-4 text-center text-gray-600">${stats.orders}</td>
                    <td class="px-6 py-4 text-center ${bCancelRate > 0.1 ? 'text-red-600 font-bold' : 'text-gray-600'}">${(bCancelRate * 100).toFixed(1)}%</td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex items-center justify-center gap-2">
                            <span class="font-mono font-medium">${healthScore.toFixed(0)}</span>
                            <div class="w-12 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full ${healthScore > 75 ? 'bg-brand' : healthScore > 40 ? 'bg-yellow-400' : 'bg-red-500'}" style="width: ${healthScore}%"></div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">${statusBadge}</td>
                `;
                tbody.appendChild(tr);
            });
    }
</script>
</body>
</html>
